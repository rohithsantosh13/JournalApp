<div class="dashboard-container">
  <nav class="navbar">
    <div class="navbar-logo">
      <svg
        class="journal-icon"
        fill="#000000"
        viewBox="0 0 32 32"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g
          id="SVGRepo_tracerCarrier"
          stroke-linecap="round"
          stroke-linejoin="round"
        ></g>
        <g id="SVGRepo_iconCarrier">
          <title>alt-book</title>
          <path
            d="M0 26.016q0 0.832 0.576 1.408t1.44 0.576q1.92 0.096 3.808 0.288t4.352 0.736 3.904 1.28q0.096 0.736 0.64 1.216t1.28 0.48 1.28-0.48 0.672-1.216q1.44-0.736 3.872-1.28t4.352-0.736 3.84-0.288q0.8 0 1.408-0.576t0.576-1.408v-24q0-0.832-0.576-1.408t-1.408-0.608q-0.032 0-0.096 0.032t-0.128 0q-9.504 0.256-12.672 2.528-1.024 0.768-1.12 1.44l-0.096-0.32q-0.576-1.28-3.168-2.176-3.648-1.28-10.528-1.472-0.064 0-0.128 0t-0.064-0.032q-0.832 0-1.44 0.608t-0.576 1.408v24zM4 24.128v-19.936q6.88 0.512 10.016 2.080v19.744q-3.104-1.536-10.016-1.888zM6.016 20q0.096 0 0.32 0.032t0.832 0.032 1.216 0.096 1.248 0.224 1.184 0.352 0.832 0.544 0.352 0.736v-4q0-0.096-0.032-0.224t-0.352-0.48-0.896-0.608-1.792-0.48-2.912-0.224v4zM6.016 12q0.096 0 0.32 0.032t0.832 0.032 1.216 0.096 1.248 0.224 1.184 0.352 0.832 0.544 0.352 0.736v-4q0-0.096-0.032-0.224t-0.352-0.48-0.896-0.608-1.792-0.48-2.912-0.224v4zM18.016 26.016v-19.744q3.104-1.568 9.984-2.080v19.936q-6.912 0.352-9.984 1.888zM20 22.016q0-0.576 0.608-0.992t1.504-0.576 1.76-0.288 1.504-0.128l0.64-0.032v-4q-1.696 0-2.944 0.224t-1.792 0.48-0.864 0.608-0.384 0.512l-0.032 0.192v4zM20 14.016q0-0.576 0.608-0.992t1.504-0.576 1.76-0.288 1.504-0.128l0.64-0.032v-4q-1.696 0-2.944 0.224t-1.792 0.48-0.864 0.608-0.384 0.512l-0.032 0.192v4z"
          ></path>
        </g>
      </svg>
      <span>JOURNAL</span>
    </div>
    <div class="navbar-links">
      <!-- Contact link removed -->
    </div>
    <div class="user-info" *ngIf="currentUser">
      <span class="user-name">{{ currentUser.userName }}</span>
      <button class="profile-btn" (click)="openUserSettings()">
        <svg width="32" height="32" viewBox="0 0 32 32">
          <circle cx="16" cy="16" r="16" fill="#eee" />
          <text x="16" y="21" text-anchor="middle" font-size="16" fill="#888">
            {{
              currentUser.userName
                ? currentUser.userName.charAt(0).toUpperCase()
                : "?"
            }}
          </text>
        </svg>
      </button>
      <!-- Floating Profile Panel -->
      <div class="profile-panel" *ngIf="showUserSettings" #profilePanel>
        <div class="profile-header">
          <div class="profile-avatar">
            <svg width="48" height="48" viewBox="0 0 32 32">
              <circle cx="16" cy="16" r="16" fill="#eee" />
              <text
                x="16"
                y="22"
                text-anchor="middle"
                font-size="22"
                fill="#888"
              >
                {{
                  currentUser.userName
                    ? currentUser.userName.charAt(0).toUpperCase()
                    : "?"
                }}
              </text>
            </svg>
          </div>
          <div class="profile-info">
            <div class="profile-name">{{ currentUser.userName }}</div>
            <div class="profile-email">{{ currentUser.email }}</div>
          </div>
        </div>
        <form class="profile-form" (ngSubmit)="saveUserSettings()">
          <label>Username</label>
          <input
            type="text"
            [(ngModel)]="userSettings.userName"
            name="userName"
          />
          <label class="toggle-label">
            <input
              type="checkbox"
              [(ngModel)]="userSettings.sentimentAnalysis"
              name="sentimentAnalysis"
            />
            <span>Enable Sentiment Analysis</span>
          </label>
          <div class="profile-actions">
            <button type="submit" class="save-btn">Save</button>
            <button
              type="button"
              class="logout-btn"
              (click)="logoutFromSettings()"
            >
              Sign Out
            </button>
          </div>
          <span class="settings-msg" *ngIf="userSettingsMsg">{{
            userSettingsMsg
          }}</span>
        </form>
      </div>
    </div>
  </nav>

  <div class="dashboard-layout">
    <aside class="sidebar">
      <button class="new-entry-btn" (click)="createNewEntry()">
        New Entry
      </button>
      <div class="sidebar-section">
        <div class="sidebar-title">Recent Entries</div>
        <ul class="journal-list">
          <li
            *ngFor="let entry of journalEntries"
            (click)="selectEntry(entry)"
            [class.selected]="selectedEntry && selectedEntry.id === entry.id"
          >
            <div class="entry-title">{{ entry.title || "Untitled Entry" }}</div>
            <div class="entry-date">
              {{ entry.date | date : "MMM d, yyyy" }}
            </div>
          </li>
        </ul>
        <div *ngIf="journalEntries.length === 0" class="no-entries-msg">
          No entries yet. Create your first one!
        </div>
      </div>
    </aside>

    <main class="main-area">
      <div *ngIf="!selectedEntry" class="welcome-area">
        <h1 class="main-title">{{ greetingMessage }}</h1>
        <div class="main-subtitle">A space for my thoughts and ideas</div>
        <div class="welcome-message">
          <p>
            Select an entry from the sidebar to edit it, or create a new entry
            to get started.
          </p>
        </div>
      </div>

      <div *ngIf="selectedEntry" class="editor-area">
        <input
          class="entry-title-input"
          [(ngModel)]="selectedEntry.title"
          placeholder="Enter your title..."
        />
        <textarea
          class="entry-content"
          [(ngModel)]="selectedEntry.content"
          placeholder="Write your journal entry here..."
        ></textarea>
        <div class="editor-actions">
          <button class="save-btn" (click)="saveEntry()" [disabled]="loading">
            {{ loading ? "Saving..." : "Save" }}
          </button>
          <button
            class="delete-btn"
            (click)="deleteEntry()"
            [disabled]="loading || !selectedEntry.id"
          >
            {{ loading ? "Deleting..." : "Delete" }}
          </button>
        </div>

        <div *ngIf="errorMsg" class="error-msg">{{ errorMsg }}</div>
        <div *ngIf="successMsg" class="success-msg">{{ successMsg }}</div>
      </div>
    </main>
  </div>
</div>
